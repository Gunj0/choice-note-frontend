# 初期セットアップ

- Cloudflare 用 Next.js セットアップ実行
  - Next.js 雛形を作成して Cloudflare デプロイまで完了
  - [Deploy a new Next.js project on Workers](https://developers.cloudflare.com/workers/framework-guides/web-apps/nextjs/#deploy-a-new-nextjs-project-on-workers)

```zsh
% npm create cloudflare@latest -- choice-note-frontend --framework=next

> npx
> "create-cloudflare" choice-note-frontend --framework=next


──────────────────────────────────────────────────────────────────────────────────────────────────────────
👋 Welcome to create-cloudflare v2.51.6!
🧡 Let's get started.
📊 Cloudflare collects telemetry about your usage of Create-Cloudflare.

Learn more at: https://github.com/cloudflare/workers-sdk/blob/main/packages/create-cloudflare/telemetry.md
──────────────────────────────────────────────────────────────────────────────────────────────────────────

╭ Create an application with Cloudflare Step 1 of 3
│
├ In which directory do you want to create your application?
│ dir ./choice-note-frontend
│
├ What would you like to start with?
│ category Framework Starter
│
├ Which development framework do you want to use?
│ framework Next.js
│
├ Select your deployment platform
│ platform Workers with Assets
│
├ Continue with Next.js via `npx create-next-app@15.4.6 choice-note-frontend`
│

✔ Would you like to use TypeScript? … Yes
✔ Would you like to use ESLint? … Yes
✔ Would you like to use Tailwind CSS? … Yes
✔ Would you like your code inside a `src/` directory? … Yes
✔ Would you like to use App Router? (recommended) … Yes
✔ Would you like to use Turbopack for `next dev`? … Yes
✔ Would you like to customize the import alias (`@/*` by default)? … No
Creating a new Next.js app in /Users/gunj0/dev/app/choice-note-frontend.

Using npm.

Initializing project with template: app-tw


Installing dependencies:
- react
- react-dom
- next

Installing devDependencies:
- typescript
- @types/node
- @types/react
- @types/react-dom
- @tailwindcss/postcss
- tailwindcss
- eslint
- eslint-config-next
- @eslint/eslintrc


added 400 packages, and audited 401 packages in 19s

166 packages are looking for funding
  run `npm fund` for details

1 moderate severity vulnerability

To address all issues, run:
  npm audit fix --force

Run `npm audit` for details.
Initialized a git repository.

Success! Created choice-note-frontend at /Users/gunj0/dev/app/choice-note-frontend

A new version of `create-next-app` is available!
You can update by running: npm i -g create-next-app

├ Copying template files
│ files copied to project directory
│
╰ Application created

╭ Configuring your application for Cloudflare Step 2 of 3
│
├ Installing wrangler A command line tool for building Cloudflare Workers
│ installed via `npm install wrangler --save-dev`
│
├ Adding the Cloudflare adapter
│ installed @opennextjs/cloudflare)}
│
├ Updating `next.config.ts`
│ updated `next.config.ts`
│
├ Adding Wrangler files to the .gitignore file
│ updated .gitignore file
│
├ Updating `package.json` scripts
│ updated `package.json`
│
├ Generating types for your application
│ generated to `./cloudflare-env.d.ts` via `npm run cf-typegen`
│
├ Installing @types/node
│ installed via npm
│
├ Do you want to use git for version control?
│ yes git
│
├ Initializing git repo
│ initialized git
│
├ Committing new files
│ git commit
│
╰ Application configured

╭ Deploy with Cloudflare Step 3 of 3
│
├ Do you want to deploy your application?
│ yes deploy via `npm run deploy`
│
├ Logging into Cloudflare checking authentication status
│ logged in
│
├ Selecting Cloudflare account retrieving accounts
│ account xxxxxxxxxxx's Account
│

> choice-note-frontend@0.1.0 deploy
> opennextjs-cloudflare build && opennextjs-cloudflare deploy


┌─────────────────────────────┐
│ OpenNext — Cloudflare build │
└─────────────────────────────┘

App directory: /Users/gunj0/dev/app/choice-note-frontend
Next.js version : 15.4.6
@opennextjs/cloudflare version: 1.8.2
@opennextjs/aws version: 3.7.6

┌─────────────────────────────────┐
│ OpenNext — Building Next.js app │
└─────────────────────────────────┘


> choice-note-frontend@0.1.0 build
> next build

Using vars defined in .dev.vars
   ▲ Next.js 15.4.6

Using vars defined in .dev.vars
   Creating an optimized production build ...
Using vars defined in .dev.vars
Using vars defined in .dev.vars
Using vars defined in .dev.vars
 ✓ Compiled successfully in 2000ms
 ✓ Linting and checking validity of types
 ✓ Collecting page data
 ✓ Generating static pages (5/5)
 ✓ Collecting build traces
 ✓ Finalizing page optimization

Route (app)                                 Size  First Load JS
┌ ○ /                                    5.44 kB         105 kB
└ ○ /_not-found                            992 B         101 kB
+ First Load JS shared by all            99.6 kB
  ├ chunks/4bd1b696-cf72ae8a39fa05aa.js  54.1 kB
  ├ chunks/964-7a34cadcb7695cec.js       43.5 kB
  └ other shared chunks (total)           1.9 kB


○  (Static)  prerendered as static content


┌──────────────────────────────┐
│ OpenNext — Generating bundle │
└──────────────────────────────┘

Bundling middleware function...
Bundling static assets...
Bundling cache assets...
Building server function: default...
Applying code patches: 1.869s
# copyPackageTemplateFiles
⚙️ Bundling the OpenNext server...

Worker saved in `.open-next/worker.js` 🚀

OpenNext build complete.

┌──────────────────────────────┐
│ OpenNext — Cloudflare deploy │
└──────────────────────────────┘

Using vars defined in .dev.vars
Incremental cache does not need populating
Tag cache does not need populating

 ⛅️ wrangler 4.36.0
───────────────────
🌀 Building list of assets...
✨ Read 39 files from the assets directory /Users/gunj0/dev/app/choice-note-frontend/.open-next/assets
🌀 Starting asset upload...
🌀 Found 29 new or modified static assets to upload. Proceeding with upload...
+ /BUILD_ID

〜略〜

Uploaded 9 of 29 assets
Uploaded 19 of 29 assets
Uploaded 29 of 29 assets
✨ Success! Uploaded 29 files (2.27 sec)

Total Upload: 4900.36 KiB / gzip: 1016.77 KiB
Worker Startup Time: 27 ms
Your Worker has access to the following bindings:
Binding            Resource
env.ASSETS         Assets

Uploaded choice-note-frontend (10.19 sec)
▲ [WARNING] Worker has workers.dev disabled, but 'workers_dev' is not in the config.

  Using fallback value 'workers_dev = true'.


Deployed choice-note-frontend triggers (1.63 sec)
  https://xxxxxxx
Current Version ID: xxxxx
(node:16903) [DEP0190] DeprecationWarning: Passing args to a child process with shell option true can lead to security vulnerabilities, as the arguments are not escaped, only concatenated.
(Use `node --trace-deprecation ...` to show where the warning was created)
├ Waiting for DNS to propagate. This might take a few minutes.
│ DNS propagation complete.
│
├ Waiting for deployment to become available
│ deployment is ready at: https://xxxxxxx
│
├ Opening browser
│
╰ Done

──────────────────────────────────────────────────────────────────────────────────────────
🎉  SUCCESS  Application deployed successfully!

🔍 View Project
Visit: https://xxxxxxx
Dash: https://xxxxxxx

💻 Continue Developing
Change directories: cd choice-note-frontend
Start dev server: npm run dev
Deploy again: npm run deploy

📖 Explore Documentation
https://developers.cloudflare.com/workers

🐛 Report an Issue
https://github.com/cloudflare/workers-sdk/issues/new/choose

💬 Join our Community
https://discord.cloudflare.com
──────────────────────────────────────────────────────────────────────────────────────────
```

- ローカル起動確認

```zsh
% cd choice-note-frontend
% npm run preview

> choice-note-frontend@0.1.0 preview
> opennextjs-cloudflare build && opennextjs-cloudflare preview


┌─────────────────────────────┐
│ OpenNext — Cloudflare build │
└─────────────────────────────┘

App directory: /Users/gunj0/dev/app/choice-note-frontend
Next.js version : 15.4.6
@opennextjs/cloudflare version: 1.8.2
@opennextjs/aws version: 3.7.6

┌─────────────────────────────────┐
│ OpenNext — Building Next.js app │
└─────────────────────────────────┘


> choice-note-frontend@0.1.0 build
> next build

Using vars defined in .dev.vars
   ▲ Next.js 15.4.6

Using vars defined in .dev.vars
   Creating an optimized production build ...
Using vars defined in .dev.vars
Using vars defined in .dev.vars
Using vars defined in .dev.vars
 ✓ Compiled successfully in 0ms
 ✓ Linting and checking validity of types
 ✓ Collecting page data
 ✓ Generating static pages (5/5)
 ✓ Collecting build traces
 ✓ Finalizing page optimization

Route (app)                                 Size  First Load JS
┌ ○ /                                    5.44 kB         105 kB
└ ○ /_not-found                            992 B         101 kB
+ First Load JS shared by all            99.6 kB
  ├ chunks/4bd1b696-cf72ae8a39fa05aa.js  54.1 kB
  ├ chunks/964-7a34cadcb7695cec.js       43.5 kB
  └ other shared chunks (total)           1.9 kB


○  (Static)  prerendered as static content


┌──────────────────────────────┐
│ OpenNext — Generating bundle │
└──────────────────────────────┘

Bundling middleware function...
Bundling static assets...
Bundling cache assets...
Building server function: default...
Applying code patches: 1.884s
# copyPackageTemplateFiles
⚙️ Bundling the OpenNext server...

Worker saved in `.open-next/worker.js` 🚀

OpenNext build complete.

┌───────────────────────────────┐
│ OpenNext — Cloudflare preview │
└───────────────────────────────┘

Incremental cache does not need populating
Tag cache does not need populating

 ⛅️ wrangler 4.36.0
───────────────────
Using vars defined in .dev.vars
Your Worker has access to the following bindings:
Binding                          Resource                  Mode
env.ASSETS                       Assets                    local
env.NEXTJS_ENV ("(hidden)")      Environment Variable      local

╭──────────────────────────────────────────────────────────────────────╮
│  [b] open a browser [d] open devtools [c] clear console [x] to exit  │
╰──────────────────────────────────────────────────────────────────────╯
⎔ Starting local server...
[wrangler:info] ✨ Parsed 1 valid header rule.
[wrangler:info] Ready on http://localhost:8787
[wrangler:info] GET / 200 OK (103ms)
[wrangler:info] GET /next.svg 200 OK (9ms)

〜略〜

[wrangler:info] GET /window.svg 200 OK (12ms)
[wrangler:info] GET /vercel.svg 200 OK (15ms)
[wrangler:info] GET /file.svg 200 OK (14ms)
```
